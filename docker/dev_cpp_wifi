

#docker system prune -af
#docker build --build-arg USERNAME=${USER}  --build-arg USER_ID=${UID} -t vulkan .
#docker run -it -v ${PWD}:/home/$USERNAME/volume vulkan
#docker run --name devenvcpp --user developer -it --mount type=volume,src=vol_devenvcpp,dst=/home/developer/volume devenvcpp/ubuntu:0.1 bash

FROM ubuntu:24.04 

# Run command deletes the default ubuntu user to free up GID 1000
RUN userdel -r ubuntu



SHELL ["/bin/bash", "-c"]
LABEL Description="Development environment"

ARG USER_ID
ARG GROUP_ID=${USER_ID}
ARG USERNAME

RUN apt-get update && apt-get -y --no-install-recommends install \
    sudo \
    bash \
    vim \
    git \
    ssh \
    build-essential \
    clang \
    cmake \
    ninja-build \
    gdb \
    wget \
    python3 \
    python3-pip \
    libmnl0 \
    libmnl-dev

RUN if [ ${USER_ID:-0} -ne 0 ] && [ ${GROUP_ID:-0} -ne 0 ] && [ -n ${USERNAME} ]; then \
    groupadd -g ${GROUP_ID} ${USERNAME} && \
    useradd -l -u ${USER_ID} -g ${GROUP_ID} -m ${USERNAME}  &&\  
    echo ${USERNAME} ALL=\(root\) NOPASSWD:ALL > /etc/sudoers.d/${USERNAME} && \
    chmod 0440 /etc/sudoers.d/${USERNAME}  \
;fi 

# Change to the user
USER $USERNAME
RUN mkdir -p /home/$USERNAME/Projects
WORKDIR /home/$USERNAME



